openapi: 3.0.0
info:
  title: HR Recruiter API
  version: 1.0.0
  description: |
    Полная OpenAPI спецификация для платформы автоматизации.
    Включает все основные сущности, бизнес-операции, заглушки для AI и медиа, а также примеры для быстрой интеграции.
    
    **Аутентификация только через JWT (Bearer). Basic Auth не поддерживается.**
servers:
  - url: http://localhost:8080/api/v1
    description: Local server
  - url: https://api.hr-recruiter.com/api/v1
    description: Production server

tags:
  - name: Auth
    description: Аутентификация и управление сессиями
  - name: Account
    description: Управление аккаунтом текущего пользователя
  - name: Positions
    description: Управление вакансиями
  - name: Candidates
    description: Управление кандидатами
  - name: Interviews
    description: Управление собеседованиями
  - name: Questions
    description: Управление вопросами для собеседований
  - name: Team & Users
    description: Управление командой и пользователями
  - name: Settings
    description: Настройки системы (тарифы, брендинг)
  - name: Analytics & Reports
    description: Статистика и отчеты
  - name: AI
    description: Взаимодействие с AI-ассистентом
  - name: Voice Interviews
    description: Голосовые интервью с ElevenLabs Conversational AI
  - name: Agents
    description: Управление AI-агентами для интервью
  - name: Webhooks
    description: Webhook обработчики для внешних сервисов

paths:
  /auth/login:
    post:
      operationId: login
      tags:
        - Auth
      summary: Вход пользователя
      security:
        - AdminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Успешный вход
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'

  /auth/logout:
    post:
      operationId: logout
      tags:
        - Auth
      summary: Выход пользователя
      security:
        - AdminAuth: []
      responses:
        '204':
          description: Успешный выход

  /account:
    get:
      operationId: getAccount
      tags:
        - Account
      summary: Получить профиль текущего пользователя
      security:
        - AdminAuth: []
      responses:
        '200':
          description: Профиль пользователя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    put:
      operationId: updateAccount
      tags:
        - Account
      summary: Обновить профиль текущего пользователя
      security:
        - AdminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        '200':
          description: Профиль обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /positions:
    get:
      operationId: listPositions
      tags:
        - Positions
      summary: Получить список вакансий
      security:
        - AdminAuth: []
      parameters:
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/PositionStatusEnum'
          description: Фильтр по статусу
        - in: query
          name: owner
          schema:
            type: string
            enum: [all, me]
            default: all
          description: Фильтр по владельцу (all - все вакансии, me - только мои)
        - in: query
          name: search
          schema:
            type: string
          description: Поиск по названию
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Номер страницы (начиная с 0)
        - in: query
          name: size
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Размер страницы
        - in: query
          name: sort
          schema:
            type: string
            default: createdAt
          description: Поле для сортировки
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionsPaginatedResponse'
    post:
      operationId: createPosition
      tags:
        - Positions
      summary: Создать новую вакансию
      security:
        - AdminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PositionCreateRequest'
      responses:
        '201':
          description: Вакансия создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Position'

  /positions/{id}:
    get:
      operationId: getPosition
      tags:
        - Positions
      summary: Получить вакансию по ID
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Position'
    put:
      operationId: updatePosition
      tags:
        - Positions
      summary: Обновить вакансию по ID
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PositionUpdateRequest'
      responses:
        '200':
          description: Вакансия обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Position'
    patch:
      operationId: partialUpdatePosition
      tags:
        - Positions
      summary: Частично обновить вакансию (для архивации)
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  $ref: '#/components/schemas/PositionStatusEnum'
                  description: Новый статус вакансии
      responses:
        '200':
          description: Вакансия обновлена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Position'

  /positions/{id}/public-link:
    get:
      operationId: getPositionPublicLink
      tags:
        - Positions
      summary: Получить публичную ссылку на вакансию
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  publicLink:
                    type: string

  /positions/{id}/stats:
    get:
      operationId: getPositionStats
      tags:
        - Positions
      summary: Получить статистику по вакансии
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionStats'

  /positions/{positionId}/questions:
    get:
      operationId: listPositionQuestions
      tags:
        - Questions
      summary: Список вопросов по вакансии
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: positionId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/PaginatedResponse'
                  - type: object
                    properties:
                      content:
                        type: array
                        items:
                          $ref: '#/components/schemas/Question'
    post:
      operationId: createPositionQuestion
      tags:
        - Questions
      summary: Добавить вопрос к вакансии
      parameters:
        - in: path
          name: positionId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestionCreateRequest'
      responses:
        '201':
          description: Вопрос добавлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Question'

  /positions/{positionId}/questions-with-settings:
    get:
      operationId: getPositionQuestionsWithSettings
      tags:
        - Questions
      security:
        - AdminAuth: []
      summary: Получить вопросы с настройками проведения собеседования
      description: Возвращает список вопросов для вакансии вместе с настройками проведения собеседования (время ответа, язык, сохранение аудио/видео и т.д.)
      parameters:
        - in: path
          name: positionId
          required: true
          schema:
            type: integer
            format: int64
          description: ID вакансии
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionQuestionsResponse'
        '404':
          description: Вакансия не найдена

  /questions:
    get:
      operationId: getAllQuestions
      tags:
        - Questions
      summary: Получить список всех вопросов
      security:
        - AdminAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
          description: Номер страницы
        - in: query
          name: size
          schema:
            type: integer
            default: 20
          description: Размер страницы
        - in: query
          name: sort
          schema:
            type: string
            default: "createdAt"
          description: Поле для сортировки
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QuestionsPaginatedResponse'

  /questions/{id}:
    get:
      operationId: getQuestion
      tags:
        - Questions
      summary: Получить вопрос по ID
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Question'
        '404':
          description: Вопрос не найден
    put:
      operationId: updateQuestion
      tags:
        - Questions
      summary: Обновить вопрос
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QuestionUpdateRequest'
      responses:
        '200':
          description: Вопрос обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Question'
    delete:
      operationId: deleteQuestion
      tags:
        - Questions
      summary: Удалить вопрос по ID
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Вопрос успешно удален

  /positions/{positionId}/candidates:
    get:
      operationId: listPositionCandidates
      tags:
        - Candidates
      summary: Список кандидатов по вакансии
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: positionId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Candidate'
    post:
      operationId: createPositionCandidate
      tags:
        - Candidates
      summary: Добавить кандидата к вакансии
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: positionId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CandidateCreateRequest'
      responses:
        '201':
          description: Кандидат добавлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Candidate'

  /candidates/{id}:
    get:
      operationId: getCandidate
      tags:
        - Candidates
      summary: Получить кандидата
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Candidate'
    put:
      operationId: updateCandidate
      tags:
        - Candidates
      summary: Обновить кандидата
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CandidateUpdateRequest'
      responses:
        '200':
          description: Кандидат обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Candidate'
    delete:
      operationId: deleteCandidate
      tags:
        - Candidates
      summary: Удалить кандидата по ID
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Кандидат успешно удален

  /candidates/{candidateId}/interview:
    post:
      operationId: createInterviewFromCandidate
      tags:
        - Interviews
      summary: Создать и начать интервью
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: candidateId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '201':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Interview'

  /positions/{positionId}/interviews:
    get:
      operationId: listPositionInterviews
      tags:
        - Interviews
      summary: Список собеседований по вакансии
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: positionId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Interview'

  /interviews:
    get:
      operationId: listInterviews
      tags:
        - Interviews
      summary: Получить список всех собеседований
      security:
        - AdminAuth: []
      description: Возвращает список всех собеседований в системе.
      parameters:
        - in: query
          name: positionId
          schema:
            type: integer
            format: int64
          description: Фильтр по ID вакансии
        - in: query
          name: candidateId
          schema:
            type: integer
            format: int64
          description: Фильтр по ID кандидата
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Номер страницы (начиная с 0)
        - in: query
          name: size
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Размер страницы
        - in: query
          name: sort
          schema:
            type: string
            default: createdAt
          description: Поле для сортировки
      responses:
        '200':
          description: Список собеседований
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterviewsPaginatedResponse'

  /interviews/{id}:
    get:
      operationId: getInterview
      tags:
        - Interviews
      summary: Получить информацию о собеседовании
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetInterview200Response'
        '404':
          description: Собеседование не найдено

  /interviews/{id}/answer:
    post:
      operationId: submitInterviewAnswer
      tags:
        - Interviews
      summary: Отправить ответ на вопрос
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InterviewAnswerCreateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Interview'

  /interviews/{id}/start:
    post:
      operationId: startInterview
      tags:
        - Interviews
      summary: Начать интервью (с поддержкой голосового режима)
      description: Начинает интервью с возможностью автоматического создания голосового агента
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InterviewStartRequest'
      responses:
        '200':
          description: Интервью успешно начато
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterviewStartResponse'
        '400':
          description: Некорректные параметры
        '404':
          description: Интервью не найдено
        '500':
          description: Ошибка создания агента

  /interviews/{id}/finish:
    post:
      operationId: finishInterview
      tags:
        - Interviews
      summary: Завершить интервью
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Интервью успешно завершено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Interview'

  /branding:
    get:
      operationId: getBranding
      tags:
        - Settings
      summary: Получить настройки брендинга
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Branding'
    put:
      operationId: updateBranding
      tags:
        - Settings
      summary: Обновить настройки брендинга
      security:
        - AdminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BrandingUpdateRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Branding'

  /users:
    get:
      operationId: listUsers
      tags:
        - Team & Users
      summary: Список пользователей
      security:
        - AdminAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Номер страницы (начиная с 0)
        - in: query
          name: size
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Размер страницы
        - in: query
          name: sort
          schema:
            type: string
            default: createdAt
          description: Поле для сортировки
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersPaginatedResponse'
    post:
      operationId: createUser
      tags:
        - Team & Users
      summary: Создать пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreateRequest'
      responses:
        '201':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/{id}:
    get:
      operationId: getUser
      tags:
        - Team & Users
      summary: Получить пользователя
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    put:
      operationId: updateUser
      tags:
        - Team & Users
      summary: Обновить пользователя
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdateRequest'
      responses:
        '200':
          description: Пользователь обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    delete:
      operationId: deleteUser
      tags:
        - Team & Users
      summary: Удалить пользователя по ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Пользователь успешно удален

  /tariffs:
    get:
      operationId: listTariffs
      tags:
        - Settings
      summary: Список тарифов
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tariff'
    post:
      operationId: createTariff
      tags:
        - Settings
      summary: Создать тариф
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TariffCreateRequest'
      responses:
        '201':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tariff'

  /tariffs/{id}:
    get:
      operationId: getTariff
      tags:
        - Settings
      summary: Получить тариф
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tariff'
    put:
      operationId: updateTariff
      tags:
        - Settings
      summary: Обновить тариф
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Tariff'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Tariff'
    delete:
      operationId: deleteTariff
      tags:
        - Settings
      summary: Удалить тариф по ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Тариф успешно удален

  /reports:
    get:
      operationId: getReports
      tags:
        - Analytics & Reports
      summary: Получить отчеты по собеседованиям
      description: Генерирует и возвращает отчеты, сгруппированные по месяцам.
      responses:
        '200':
          description: Успешный ответ с отчетами
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MonthlyReport'

  /ai/transcribe:
    post:
      operationId: transcribeAudio
      tags:
        - AI
      summary: Транскрибировать аудио файл
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - audio
              properties:
                audio:
                  type: string
                  format: binary
                  description: Аудио файл для транскрибации
      responses:
        '200':
          description: Аудио успешно транскрибировано
          content:
            application/json:
              schema:
                type: object
                properties:
                  transcript:
                    type: string
                    description: Транскрибированный текст



  /ai/generate-position:
    post:
      operationId: generatePosition
      tags:
        - AI
      summary: Генерировать вакансию с помощью AI
      description: |
        Генерирует структуру вакансии на основе описания пользователя.
        AI возвращает минимальный набор полей (title, description, topics, level, questions).
        Остальные поля (status, language, settings и т.д.) устанавливаются системой по умолчанию.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PositionAiGenerationRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionAiGenerationResponse'
        '400':
          description: Bad Request - некорректные входные данные
        '500':
          description: Internal Server Error - ошибка AI или системы

  /stats/interviews:
    get:
      operationId: getInterviewsStats
      tags:
        - Analytics & Reports
      summary: Статистика по интервью
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterviewStats'

  /activity:
    get:
      operationId: getActivityFeed
      tags:
        - Analytics & Reports
      summary: Получить ленту активности
      description: Возвращает ленту активности пользователей в системе
      security:
        - AdminAuth: []
      parameters:
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            maximum: 100
            minimum: 1
          description: Количество записей для получения
        - in: query
          name: type
          schema:
            type: string
            enum: [all, interview, position, candidate, hired]
            default: all
          description: Фильтр по типу активности
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Номер страницы (начиная с 0)
      responses:
        '200':
          description: Лента активности
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActivityPaginatedResponse'
        '400':
          description: Некорректные параметры
        '500':
          description: Ошибка сервера

  /stats/positions:
    get:
      operationId: getPositionsStats
      tags:
        - Analytics & Reports
      summary: Статистика по вакансиям
      description: Возвращает расширенную статистику по вакансиям с группировками
      security:
        - AdminAuth: []
      parameters:
        - in: query
          name: includeDetails
          schema:
            type: boolean
            default: false
          description: Включить детальную статистику с группировками
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionStats'

  /stats/candidates:
    get:
      operationId: getCandidatesStats
      tags:
        - Analytics & Reports
      summary: Статистика по кандидатам
      description: Возвращает расширенную статистику по кандидатам с группировками
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CandidateStats'

  /archive:
    get:
      operationId: getArchive
      summary: Архив
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object

  /learn:
    get:
      operationId: getLearn
      summary: Обучающие материалы
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    title:
                      type: string
                    url:
                      type: string
                    description:
                      type: string

  /tariff/info:
    get:
      operationId: getTariffInfo
      tags:
        - Settings
      summary: Информация о тарифе пользователя
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  interviewsLeft:
                    type: integer
                  until:
                    type: string

  /team:
    get:
      operationId: getTeam
      tags:
        - Team & Users
      summary: Получить информацию о команде
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

  /user/info:
    get:
      operationId: getUserInfo
      tags:
        - Account
      summary: Получить дополнительную информацию о пользователе
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  phone:
                    type: string

  /ai/generate-position-data:
    post:
      operationId: generatePositionData
      tags:
        - AI
      summary: Сгенерировать данные для вакансии на основе описания
      security:
        - AdminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PositionDataGenerationRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionDataGenerationResponse'
        '400':
          description: Неверный запрос
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Ошибка генерации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /checklist:
    get:
      operationId: getChecklist
      tags:
        - Interviews
      summary: Чек-лист для интервью
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    text:
                      type: string

  /invite/info:
    get:
      operationId: getInviteInfo
      tags:
        - Interviews
      summary: Информация для приглашения
      security:
        - AdminAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  language:
                    type: string
                  questionsCount:
                    type: integer

  /ai/transcribe-answer:
    post:
      operationId: transcribeAnswerWithAI
      tags:
        - AI
      summary: Транскрибировать и отформатировать аудио ответ на интервью
      description: |
        Обрабатывает аудио файл через пайплайн:
        1. Whisper - транскрибация в сырой текст
        2. Claude - форматирование текста (без добавления контента)
        3. Сохранение результата в базу данных

        Сохраняет как сырой, так и отформатированный текст.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - audioFile
                - interviewId
                - questionId
              properties:
                audioFile:
                  type: string
                  format: binary
                  description: Аудио файл для транскрибации
                interviewId:
                  type: integer
                  format: int64
                  description: ID интервью (определяет кандидата и позицию)
                questionId:
                  type: integer
                  format: int64
                  description: ID вопроса для создания ответа
      responses:
        '200':
          description: Аудио успешно обработано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranscribeAnswerWithAI200Response'
        '400':
          description: Неверные параметры запроса
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Audio file is empty"
        '404':
          description: Интервью или вопрос не найден
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Interview or question not found"
        '503':
          description: Сервисы транскрибации недоступны
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Transcription services are not available"

  /candidates:
    get:
      operationId: listCandidates
      tags:
        - Candidates
      summary: Получить список всех кандидатов
      security:
        - AdminAuth: []
      parameters:
        - in: query
          name: positionId
          schema:
            type: integer
            format: int64
          description: Фильтр по ID вакансии
        - in: query
          name: search
          schema:
            type: string
          description: Поиск по имени или email
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Номер страницы (начиная с 0)
        - in: query
          name: size
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Размер страницы
        - in: query
          name: sort
          schema:
            type: string
            default: createdAt
          description: Поле для сортировки
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CandidatesPaginatedResponse'

  # Voice Interview Endpoints
  /interviews/{interviewId}/voice/session:
    post:
      operationId: createVoiceSession
      tags:
        - Voice Interviews
      summary: Создать голосовую сессию для интервью
      description: Создает голосовую сессию в ElevenLabs Conversational AI для проведения голосового интервью
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: interviewId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoiceSessionCreateRequest'
      responses:
        '201':
          description: Голосовая сессия создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceSessionResponse'
        '400':
          description: Некорректный запрос
        '404':
          description: Интервью не найдено
        '500':
          description: Ошибка сервера

  /interviews/{interviewId}/voice/next-question:
    get:
      operationId: getNextQuestion
      tags:
        - Voice Interviews
      summary: Получить следующий вопрос для голосовой сессии
      description: Возвращает следующий вопрос для голосового интервью. Вызывается ElevenLabs агентом через webhook.
      parameters:
        - in: path
          name: interviewId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceMessage'
        '404':
          description: Интервью не найдено
        '500':
          description: Ошибка сервера

  /interviews/{interviewId}/voice/answer:
    post:
      operationId: saveVoiceAnswer
      tags:
        - Voice Interviews
      summary: Сохранить голосовой ответ кандидата
      description: Сохраняет транскрибированный голосовой ответ кандидата на вопрос
      parameters:
        - in: path
          name: interviewId
          required: true
          schema:
            type: integer
            format: int64
        - in: query
          name: questionId
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoiceMessage'
      responses:
        '201':
          description: Ответ сохранен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InterviewAnswer'
        '400':
          description: Некорректный запрос
        '404':
          description: Интервью или вопрос не найдены
        '500':
          description: Ошибка сервера

  /interviews/{interviewId}/voice/end:
    post:
      operationId: endVoiceSession
      tags:
        - Voice Interviews
      summary: Завершить голосовую сессию
      description: Завершает голосовую сессию и освобождает ресурсы
      parameters:
        - in: path
          name: interviewId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Сессия завершена
        '404':
          description: Интервью не найдено
        '500':
          description: Ошибка сервера

  /interviews/{interviewId}/voice/status:
    get:
      operationId: getVoiceSessionStatus
      tags:
        - Voice Interviews
      summary: Получить статус голосовой сессии
      description: Возвращает текущий статус голосовой сессии
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: interviewId
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoiceSessionStatus'
        '404':
          description: Интервью не найдено
        '500':
          description: Ошибка сервера

  # Agent Management Endpoints
  /agents:
    get:
      operationId: listAgents
      tags:
        - Agents
      summary: Получить список агентов
      description: Возвращает список всех AI-агентов в системе
      security:
        - AdminAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 0
            minimum: 0
          description: Номер страницы (начиная с 0)
        - in: query
          name: size
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
          description: Размер страницы
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/AgentStatusEnum'
          description: Фильтр по статусу агента
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentsPaginatedResponse'
    post:
      operationId: createAgent
      tags:
        - Agents
      summary: Создать нового агента
      description: Создает нового AI-агента для проведения интервью
      security:
        - AdminAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentCreateRequest'
      responses:
        '201':
          description: Агент создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '400':
          description: Некорректные данные
        '500':
          description: Ошибка создания агента

  /agents/{id}:
    get:
      operationId: getAgent
      tags:
        - Agents
      summary: Получить агента по ID
      description: Возвращает информацию о конкретном агенте
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '404':
          description: Агент не найден
    put:
      operationId: updateAgent
      tags:
        - Agents
      summary: Обновить агента
      description: Обновляет конфигурацию агента
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentUpdateRequest'
      responses:
        '200':
          description: Агент обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'
        '404':
          description: Агент не найден
    delete:
      operationId: deleteAgent
      tags:
        - Agents
      summary: Удалить агента
      description: Удаляет агента и освобождает ресурсы в ElevenLabs
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '204':
          description: Агент удален
        '404':
          description: Агент не найден

  /agents/{id}/test:
    post:
      operationId: testAgent
      tags:
        - Agents
      summary: Протестировать агента
      description: Отправляет тестовое сообщение агенту для проверки его работы
      security:
        - AdminAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentTestRequest'
      responses:
        '200':
          description: Тест выполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentTestResponse'
        '404':
          description: Агент не найден

  # Webhook Endpoints
  /webhooks/elevenlabs/events:
    post:
      operationId: handleElevenLabsWebhook
      tags:
        - Webhooks
      summary: Обработчик событий ElevenLabs
      description: Принимает webhook события от ElevenLabs Conversational AI
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ElevenLabsWebhookEvent'
      responses:
        '200':
          description: Событие обработано
        '400':
          description: Некорректные данные
        '500':
          description: Ошибка обработки



  /candidates/auth:
    post:
      operationId: authCandidate
      tags:
        - Candidates
      summary: Авторизация кандидата (find-or-create и JWT)
      description: |
        Находит или создает кандидата по имени, email, телефону и позиции. Возвращает JWT для кандидата и его DTO.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CandidateAuthRequest'
      responses:
        '200':
          description: Успешная авторизация кандидата
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CandidateAuthResponse'
        '400':
          description: Неверные параметры запроса
        '500':
          description: Внутренняя ошибка сервера
      security: []

components:
  schemas:
    # Базовые компоненты
    BaseEntity:
      type: object
      properties:
        id:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, createdAt]
    
    # Общий класс для пагинированных ответов
    PaginatedResponse:
      type: object
      description: "Базовый класс для всех пагинированных ответов"
      properties:
        content:
          type: array
          description: "Список элементов на текущей странице"
          items:
            type: object
        totalElements:
          type: integer
          format: int64
          description: "Общее количество элементов"
          example: 150
        totalPages:
          type: integer
          format: int64
          description: "Общее количество страниц"
          example: 15
        number:
          type: integer
          format: int64
          description: "Номер текущей страницы (начиная с 0)"
          example: 0
        size:
          type: integer
          format: int64
          description: "Размер страницы"
          example: 10
      required: [content, totalElements, totalPages, number, size]
    
    # Пагинированные ответы для разных сущностей
    QuestionsPaginatedResponse:
      $ref: '#/components/schemas/PaginatedResponse'
      description: "Пагинированный список вопросов"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Question'

    PositionsPaginatedResponse:
      $ref: '#/components/schemas/PaginatedResponse'
      description: "Пагинированный список позиций"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Position'

    UsersPaginatedResponse:
      $ref: '#/components/schemas/PaginatedResponse'
      description: "Пагинированный список пользователей"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/User'

    CandidatesPaginatedResponse:
      $ref: '#/components/schemas/PaginatedResponse'
      description: "Пагинированный список кандидатов"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Candidate'

    InterviewsPaginatedResponse:
      $ref: '#/components/schemas/PaginatedResponse'
      description: "Пагинированный список интервью"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Interview'
    
    BasePositionFields:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/PositionStatusEnum'
        ownerId:
          type: integer
          format: int64
          description: "ID владельца вакансии"
          example: 1
        topics:
          type: array
          items:
            type: string
          description: "Ключевые темы/теги позиции"
        minScore:
          type: number
          format: float
          description: "Минимальный проходной балл"
        language:
          type: string
          description: "Язык собеседования"
          example: "Русский"
        showOtherLang:
          type: boolean
          description: "Показывать результаты на другом языке"
        answerTime:
          type: integer
          description: "Время на ответ в секундах"
          example: 150
        level:
          $ref: '#/components/schemas/PositionLevelEnum'
        saveAudio:
          type: boolean
          description: "Сохранять аудио"
        saveVideo:
          type: boolean
          description: "Сохранять видео"
        randomOrder:
          type: boolean
          description: "Случайный порядок вопросов"
        questionType:
          type: string
          description: "Тип вопросов"
          example: "В основном хард-скиллы"
        questionsCount:
          type: integer
          description: "Количество вопросов"
          example: 5
        checkType:
          type: string
          description: "Тип проверки"
        tags:
          type: array
          items:
            type: string
          description: "Теги позиции"
    
    BaseQuestionFields:
      type: object
      properties:
        text:
          type: string
        type:
          $ref: '#/components/schemas/QuestionTypeEnum'
        order:
          type: integer
        isRequired:
          type: boolean
        maxDuration:
          type: integer
          description: "Максимальная длительность ответа в секундах"
        options:
          type: array
          items:
            type: string
          description: "Варианты ответов для вопросов типа CHOICE"
        evaluationCriteria:
          type: string
          description: "Критерии оценки ответа"
    
    BaseCandidateFields:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        name:
          type: string
        email:
          type: string
        phone:
          type: string
        status:
          $ref: '#/components/schemas/CandidateStatusEnum'
        resumeUrl:
          type: string
          description: "URL резюме кандидата"
        coverLetter:
          type: string
          description: "Сопроводительное письмо"
        experienceYears:
          type: integer
          description: "Годы опыта работы"
        skills:
          type: array
          items:
            type: string
          description: "Навыки кандидата"
    
    BaseUserFields:
      type: object
      properties:
        firstName:
          type: string
          description: "Имя пользователя"
        lastName:
          type: string
          description: "Фамилия пользователя"
        email:
          type: string
        role:
          $ref: '#/components/schemas/RoleEnum'
        avatarUrl:
          type: string
        language:
          type: string
        phone:
          type: string
    
    # Основные схемы
    LoginRequest:
      type: object
      properties:
        email:
          type: string
        password:
          type: string
      required: [email, password]
    
    AuthResponse:
      type: object
      properties:
        token:
          type: string
        user:
          $ref: '#/components/schemas/User'
    
    User:
      allOf:
        - $ref: '#/components/schemas/BaseEntity'
        - $ref: '#/components/schemas/BaseUserFields'
      required: [id, firstName, lastName, email, role, createdAt]
    
    UserCreateRequest:
      type: object
      properties:
        firstName:
          type: string
          description: "Имя пользователя"
        lastName:
          type: string
          description: "Фамилия пользователя"
        email:
          type: string
        role:
          $ref: '#/components/schemas/RoleEnum'
        avatarUrl:
          type: string
        language:
          type: string
        phone:
          type: string
        password:
          type: string
      required: [firstName, lastName, email, role, password]
    
    UserUpdateRequest:
      $ref: '#/components/schemas/BaseUserFields'
    
    Position:
      allOf:
        - $ref: '#/components/schemas/BaseEntity'
        - $ref: '#/components/schemas/BasePositionFields'
        - type: object
          properties:
            company:
              type: string
            publicLink:
              type: string
            team:
              type: array
              items:
                $ref: '#/components/schemas/User'
            interviews:
              type: array
              items:
                $ref: '#/components/schemas/Interview'
            avgScore:
              type: number
              format: float
              description: "Средний балл по позиции"
          required: [id, title, company, status, createdAt]
    
    PositionCreateRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/PositionStatusEnum'
        topics:
          type: array
          items:
            type: string
        minScore:
          type: number
          format: float
        language:
          type: string
        showOtherLang:
          type: boolean
        tags:
          type: array
          items:
            type: string
        answerTime:
          type: integer
        level:
          $ref: '#/components/schemas/PositionLevelEnum'
        saveAudio:
          type: boolean
        saveVideo:
          type: boolean
        randomOrder:
          type: boolean
        questionType:
          type: string
        questionsCount:
          type: integer
        checkType:
          type: string
        team:
          type: array
          items:
            type: string
        brandingId:
          type: string
      required: [title, status]
    
    PositionUpdateRequest:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          $ref: '#/components/schemas/PositionStatusEnum'
        topics:
          type: array
          items:
            type: string
        minScore:
          type: number
          format: float
        language:
          type: string
        showOtherLang:
          type: boolean
        tags:
          type: array
          items:
            type: string
        answerTime:
          type: integer
        level:
          $ref: '#/components/schemas/PositionLevelEnum'
        saveAudio:
          type: boolean
        saveVideo:
          type: boolean
        randomOrder:
          type: boolean
        questionType:
          type: string
        questionsCount:
          type: integer
        checkType:
          type: string
        team:
          type: array
          items:
            type: string
        brandingId:
          type: string
    
    PositionStats:
      type: object
      properties:
        positionId:
          type: integer
          format: int64
          description: "ID позиции (если статистика для конкретной позиции)"
        interviewsTotal:
          type: integer
          description: "Всего собеседований"
        interviewsSuccessful:
          type: integer
          description: "Успешно завершенные"
        interviewsInProgress:
          type: integer
          description: "В процессе"
        interviewsUnsuccessful:
          type: integer
          description: "Неуспешно завершенные"
        total:
          type: integer
          description: "Общее количество вакансий"
        active:
          type: integer
          description: "Активные вакансии"
        paused:
          type: integer
          description: "Вакансии на паузе"
        archived:
          type: integer
          description: "Архивные вакансии"
        byLevel:
          type: object
          properties:
            junior:
              type: integer
              description: "Количество junior позиций"
            middle:
              type: integer
              description: "Количество middle позиций"
            senior:
              type: integer
              description: "Количество senior позиций"
            lead:
              type: integer
              description: "Количество lead позиций"
          description: "Группировка по уровням (если includeDetails=true)"
    
    Question:
      allOf:
        - $ref: '#/components/schemas/BaseEntity'
        - $ref: '#/components/schemas/BaseQuestionFields'
        - type: object
          properties:
            positionId:
              type: integer
          required: [id, positionId, text, type, order, createdAt]
    
    QuestionCreateRequest:
      type: object
      properties:
        text:
          type: string
        type:
          $ref: '#/components/schemas/QuestionTypeEnum'
        order:
          type: integer
        isRequired:
          type: boolean
        evaluationCriteria:
          type: string
      required: [text, type, order]
    
    QuestionUpdateRequest:
      $ref: '#/components/schemas/BaseQuestionFields'
    
    Candidate:
      allOf:
        - $ref: '#/components/schemas/BaseEntity'
        - $ref: '#/components/schemas/BaseCandidateFields'
        - type: object
          properties:
            positionId:
              type: integer
          required: [id, firstName, lastName, status, positionId, createdAt]
    
    CandidateCreateRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        phone:
          type: string
      required: [firstName, lastName]
    
    CandidateUpdateRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        name:
          type: string
        email:
          type: string
        phone:
          type: string
        status:
          $ref: '#/components/schemas/CandidateStatusEnum'
    
    Interview:
      type: object
      properties:
        id:
          type: integer
        candidateId:
          type: integer
        positionId:
          type: integer
        status:
          $ref: '#/components/schemas/InterviewStatusEnum'
        result:
          $ref: '#/components/schemas/InterviewResultEnum'
        createdAt:
          type: string
          format: date-time
          description: "Дата создания собеседования"
        startedAt:
          type: string
          format: date-time
          description: "Дата начала собеседования"
        finishedAt:
          type: string
          format: date-time
          description: "Дата окончания собеседования"
        transcript:
          type: string
        audioUrl:
          type: string
        videoUrl:
          type: string
        aiScore:
          type: number
        notes:
          type: string
          description: "Заметки по интервью"
        voiceSessionId:
          type: string
          description: "ID голосовой сессии в ElevenLabs"
        voiceAgentId:
          type: string
          description: "ID агента в ElevenLabs"
        voiceEnabled:
          type: boolean
          description: "Включено ли голосовое интервью"
        voiceLanguage:
          type: string
          description: "Язык голосового интервью"
        voiceVoiceId:
          type: string
          description: "ID голоса в ElevenLabs"
        voiceStartedAt:
          type: string
          format: date-time
          description: "Время начала голосовой сессии"
        voiceFinishedAt:
          type: string
          format: date-time
          description: "Время завершения голосовой сессии"
        answers:
          type: array
          items:
            $ref: '#/components/schemas/InterviewAnswer'
        candidate:
          $ref: '#/components/schemas/Candidate'
          description: "Данные кандидата"
      required:
        - id
        - candidateId
        - positionId
        - status
        - createdAt
    
    InterviewAnswer:
      type: object
      properties:
        id:
          type: integer
          format: int64
        interviewId:
          type: integer
          format: int64
        questionId:
          type: integer
          format: int64
        answerText:
          type: string
        audioUrl:
          type: string
        videoUrl:
          type: string
        rawTranscription:
          type: string
          description: "Сырой транскрибированный текст"
        formattedTranscription:
          type: string
          description: "Отформатированный текст"
        transcript:
          type: string
          description: "Транскрибированный текст (alias для formattedTranscription)"
        score:
          type: number
          format: float
          description: "Оценка ответа от 0 до 100"
        scoreJustification:
          type: string
          description: "Обоснование оценки"
        feedback:
          type: string
          description: "Обратная связь по ответу"
        durationSeconds:
          type: integer
          description: "Длительность ответа в секундах"
        isCorrect:
          type: boolean
          description: "Правильность ответа для вопросов типа CHOICE"
        voiceSessionId:
          type: string
          description: "ID голосовой сессии"
        voiceConfidence:
          type: number
          format: float
          description: "Уверенность в распознавании речи (0.0-1.0)"
        voiceEmotion:
          type: string
          description: "Определенная эмоция в голосе"
        voiceSpeakerId:
          type: string
          description: "ID говорящего"
        voiceAudioUrl:
          type: string
          description: "URL аудио файла ответа"
        voiceProcessingTime:
          type: integer
          format: int64
          description: "Время обработки в миллисекундах"
        voiceQualityScore:
          type: number
          format: float
          description: "Оценка качества аудио (0.0-1.0)"
        createdAt:
          type: string
          format: date-time
      required: [id, interviewId, questionId]
    
    InterviewAnswerCreateRequest:
      type: object
      properties:
        questionId:
          type: integer
          format: int64
        answerText:
          type: string
        audioUrl:
          type: string
        transcript:
          type: string
      required: [questionId]
    
    InterviewTranscribeResponse:
      type: object
      properties:
        questionId:
          type: integer
          format: int64
        transcript:
          type: string
      required: [questionId, transcript]
    
    Branding:
      allOf:
        - $ref: '#/components/schemas/BaseEntity'
        - type: object
          properties:
            companyName:
              type: string
            logoUrl:
              type: string
            primaryColor:
              type: string
            secondaryColor:
              type: string
            emailSignature:
              type: string
          required: [id, companyName, createdAt]
    
    BrandingUpdateRequest:
      type: object
      properties:
        companyName:
          type: string
        logoUrl:
          type: string
        primaryColor:
          type: string
        secondaryColor:
          type: string
        emailSignature:
          type: string
    
    Tariff:
      allOf:
        - $ref: '#/components/schemas/BaseEntity'
        - type: object
          properties:
            name:
              type: string
            features:
              type: array
              items:
                type: string
            price:
              type: number
            isActive:
              type: boolean
          required: [id, name, price, createdAt]
    
    TariffCreateRequest:
      type: object
      properties:
        name:
          type: string
        features:
          type: array
          items:
            type: string
        price:
          type: number
        isActive:
          type: boolean
      required: [name, price]
    
    TariffUpdateRequest:
      type: object
      properties:
        name:
          type: string
        features:
          type: array
          items:
            type: string
        price:
          type: number
        isActive:
          type: boolean
    
    # Enums
    PositionStatusEnum:
      type: string
      enum:
        - active
        - paused
        - archived
    
    CandidateStatusEnum:
      type: string
      enum:
        - new
        - in_progress
        - finished
        - rejected
        - hired
    
    InterviewStatusEnum:
      type: string
      enum:
        - not_started
        - in_progress
        - finished
    
    InterviewResultEnum:
      type: string
      enum:
        - successful
        - unsuccessful
        - error
    
    QuestionTypeEnum:
      type: string
      enum:
        - text
        - audio
        - video
        - choice
    
    PositionLevelEnum:
      type: string
      enum:
        - junior
        - middle
        - senior
        - lead
      description: "Уровень позиции"
    
    RoleEnum:
      type: string
      enum:
        - admin
        - recruiter
        - viewer
    
    # Stats
    CandidateStats:
      type: object
      properties:
        total:
          type: integer
          description: "Общее количество кандидатов"
        inProgress:
          type: integer
          description: "Кандидаты в процессе"
        finished:
          type: integer
          description: "Завершенные кандидаты"
        hired:
          type: integer
          description: "Нанятые кандидаты"
        rejected:
          type: integer
          description: "Отклоненные кандидаты"
    
    InterviewStats:
      type: object
      properties:
        total:
          type: integer
          description: "Общее количество интервью"
        successful:
          type: integer
          description: "Успешно завершенные интервью"
        unsuccessful:
          type: integer
          description: "Неуспешно завершенные интервью"
        inProgress:
          type: integer
          description: "Интервью в процессе"
        notStarted:
          type: integer
          description: "Интервью не начатые"
        cancelled:
          type: integer
          description: "Отмененные интервью"

    ActivityItem:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: "ID записи активности"
        type:
          type: string
          enum: [interview, position, candidate, hired, report, login]
          description: "Тип активности"
        title:
          type: string
          description: "Заголовок активности"
        description:
          type: string
          description: "Описание активности"
        userId:
          type: integer
          format: int64
          description: "ID пользователя"
        userName:
          type: string
          description: "Имя пользователя"
        entityId:
          type: integer
          format: int64
          description: "ID связанной сущности"
        entityType:
          type: string
          enum: [interview, position, candidate, report]
          description: "Тип связанной сущности"
        createdAt:
          type: string
          format: date-time
          description: "Время создания записи"
        metadata:
          type: object
          additionalProperties: true
          description: "Дополнительные данные"
      required: [id, type, title, createdAt]

    ActivityPaginatedResponse:
      $ref: '#/components/schemas/PaginatedResponse'
      description: "Пагинированный список записей активности"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/ActivityItem'
    
    MonthlyReport:
      type: object
      properties:
        month:
          type: string
          example: "Июль 2024"
        totalInterviews:
          type: integer
        successful:
          type: integer
        unsuccessful:
          type: integer
        avgScore:
          type: number
          format: float
        dynamics:
          type: integer
          description: "Динамика в % по сравнению с прошлым месяцем"
          example: 15

    PositionDataGenerationRequest:
      type: object
      properties:
        description:
          type: string
          description: "Описание вакансии для генерации данных"
          example: "Нужен Java разработчик для разработки микросервисов"
        existingData:
          type: object
          description: "Существующие данные вакансии (опционально)"
          properties:
            title:
              type: string
            topics:
              type: array
              items:
                type: string
            level:
              $ref: '#/components/schemas/PositionLevelEnum'
            tags:
              type: array
              items:
                type: string
      required: [description]

    PositionDataGenerationResponse:
      type: object
      properties:
        generatedData:
          type: object
          properties:
            title:
              type: string
              description: "Сгенерированное название вакансии"
              example: "Java Backend Developer"
            topics:
              type: array
              items:
                type: string
              description: "Сгенерированные темы для собеседования"
              example: ["Java Core", "Spring Framework", "Microservices", "Database Design"]
            level:
              $ref: '#/components/schemas/PositionLevelEnum'
              description: "Предлагаемый уровень позиции"
            tags:
              type: array
              items:
                type: string
              description: "Сгенерированные теги"
              example: ["Java", "Backend", "Spring", "Microservices"]
            suggestedDescription:
              type: string
              description: "Улучшенное описание вакансии"
        confidence:
          type: number
          format: float
          description: "Уверенность в генерации (0-1)"
          example: 0.85
        message:
          type: string
          description: "Сообщение о результатах генерации"
          example: "Данные успешно сгенерированы на основе описания"

    PositionQuestionsResponse:
      type: object
      description: "Ответ с вопросами вакансии и настройками проведения собеседования"
      properties:
        questions:
          type: array
          items:
            $ref: '#/components/schemas/Question'
          description: "Список вопросов для вакансии"
        interviewSettings:
          type: object
          description: "Настройки проведения собеседования"
          properties:
            answerTime:
              type: integer
              description: "Время ответа на вопрос в секундах"
              example: 120
            language:
              type: string
              description: "Язык собеседования"
              example: "ru"
            showOtherLang:
              type: boolean
              description: "Показывать вопросы на других языках"
              example: false
            saveAudio:
              type: boolean
              description: "Сохранять аудио"
              example: true
            saveVideo:
              type: boolean
              description: "Сохранять видео"
              example: false
            randomOrder:
              type: boolean
              description: "Случайный порядок вопросов"
              example: false
            questionType:
              type: string
              description: "Тип вопросов"
              example: "mixed"
            questionsCount:
              type: integer
              description: "Количество вопросов"
              example: 10
            checkType:
              type: string
              description: "Тип проверки"
              example: "ai"
            level:
              type: string
              description: "Уровень позиции"
              example: "middle"
      required: [questions, interviewSettings]

    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          description: "Сообщение об ошибке"
          example: "Произошла ошибка при обработке запроса"
        error:
          type: string
          description: "Тип ошибки"
          example: "VALIDATION_ERROR"
        timestamp:
          type: string
          format: date-time
          description: "Время возникновения ошибки"
          example: "2024-01-15T10:30:45Z"
        path:
          type: string
          description: "Путь запроса"
          example: "/api/positions"
      required: [message, error, timestamp]

    TranscribeAnswerWithAI200Response:
      type: object
      properties:
        success:
          type: boolean
          example: true
        formattedText:
          type: string
          description: Отформатированный текст от Claude
          example: "Я работал в компании три года, занимался разработкой на Java."
        interviewAnswerId:
          type: integer
          format: int64
          description: ID ответа на интервью

    # AI-генерация вакансии
    PositionAiGenerationRequest:
      type: object
      description: "Запрос на генерацию вакансии с помощью AI"
      properties:
        description:
          type: string
          description: "Описание вакансии от пользователя"
          example: "Нужен Java разработчик для разработки микросервисов"
        questionsCount:
          type: integer
          description: "Количество вопросов для собеседования"
          example: 5
          minimum: 1
          maximum: 20
        questionType:
          type: string
          description: "Тип вопросов (hard, soft, mixed)"
          example: "hard"
      required: [description]

    PositionAiGenerationResponse:
      type: object
      description: "Ответ AI с минимальной структурой вакансии"
      properties:
        title:
          type: string
          description: "Название вакансии"
          example: "Java Backend Developer"
        description:
          type: string
          description: "Описание вакансии"
          example: "Разработка микросервисов на Java с использованием Spring Framework"
        topics:
          type: array
          items:
            type: string
          description: "Ключевые темы/навыки для собеседования"
          example: ["Java Core", "Spring Framework", "Microservices", "Database Design"]
        level:
          type: string
          enum: [junior, middle, senior, lead]
          description: "Уровень позиции"
          example: "middle"
        questions:
          type: array
          items:
            $ref: '#/components/schemas/PositionAiQuestion'
          description: "Список вопросов для собеседования"
      required: [title, topics, level, questions]

    PositionAiQuestion:
      type: object
      description: "Вопрос для собеседования (AI-генерация)"
      properties:
        text:
          type: string
          description: "Текст вопроса"
          example: "Расскажите о принципах SOLID"
        type:
          type: string
          enum: [text, audio, choice]
          description: "Тип вопроса"
          example: "text"
        order:
          type: integer
          description: "Порядок вопроса"
          example: 1
      required: [text, type, order]



    GetInterview200Response:
      type: object
      properties:
        interview:
          $ref: '#/components/schemas/Interview'
        candidate:
          $ref: '#/components/schemas/Candidate'
        position:
          $ref: '#/components/schemas/Position'
        questions:
          type: array
          items:
            $ref: '#/components/schemas/Question'



    CandidateAuthRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
        - phone
        - positionId
      properties:
        firstName:
          type: string
          example: Иван
        lastName:
          type: string
          example: Иванов
        email:
          type: string
          format: email
          example: ivan@example.com
        phone:
          type: string
          example: "+79991234567"
        positionId:
          type: integer
          format: int64
          example: 123

    CandidateAuthResponse:
      type: object
      required:
        - token
        - candidate
      properties:
        token:
          type: string
          description: JWT токен для авторизации кандидата
        candidate:
          $ref: '#/components/schemas/Candidate'

    # Voice Interview Schemas
    VoiceSessionCreateRequest:
      type: object
      properties:
        voiceMode:
          type: boolean
          description: Включить голосовой режим
          default: false
        agentConfig:
          $ref: '#/components/schemas/AgentConfig'
        voiceSettings:
          $ref: '#/components/schemas/VoiceSettings'
        autoCreateAgent:
          type: boolean
          description: Автоматически создать агента
          default: true

    VoiceSessionResponse:
      type: object
      properties:
        sessionId:
          type: string
          description: "ID голосовой сессии в ElevenLabs"
        agentId:
          type: string
          description: "ID агента в ElevenLabs"
        status:
          $ref: '#/components/schemas/VoiceSessionStatusEnum'
          description: "Статус сессии"
        webhookUrl:
          type: string
          description: "URL для webhook событий"
        createdAt:
          type: string
          format: date-time
          description: "Время создания сессии"

    VoiceSessionStatus:
      type: object
      properties:
        sessionId:
          type: string
          description: "ID голосовой сессии"
        status:
          $ref: '#/components/schemas/VoiceSessionStatusEnum'
          description: "Статус голосовой сессии"
        currentQuestion:
          type: integer
          description: "Номер текущего вопроса"
        totalQuestions:
          type: integer
          description: "Общее количество вопросов"
        duration:
          type: integer
          description: "Длительность сессии в секундах"
        lastActivity:
          type: string
          format: date-time
          description: "Время последней активности"

    VoiceMessage:
      type: object
      properties:
        text:
          type: string
          description: "Текст сообщения"
        audioUrl:
          type: string
          description: "URL аудио файла"
        durationMs:
          type: integer
          description: "Длительность аудио в миллисекундах"
        confidence:
          type: number
          format: float
          description: "Уверенность транскрибации (0-1)"
        timestamp:
          type: string
          format: date-time
          description: "Время сообщения"
        type:
          $ref: '#/components/schemas/VoiceMessageTypeEnum'

    # Agent Schemas
    Agent:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: "ID агента в системе"
        name:
          type: string
          description: "Название агента"
        description:
          type: string
          description: "Описание агента"
        elevenLabsAgentId:
          type: string
          description: "ID агента в ElevenLabs"
        status:
          $ref: '#/components/schemas/AgentStatusEnum'
        config:
          $ref: '#/components/schemas/AgentConfig'
        interviewId:
          type: integer
          format: int64
          description: "ID интервью, для которого создан агент"
        positionId:
          type: integer
          format: int64
          description: "ID позиции"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required: [id, name, elevenLabsAgentId, status, createdAt]

    AgentCreateRequest:
      type: object
      properties:
        name:
          type: string
          description: "Название агента"
        description:
          type: string
          description: "Описание агента"
        interviewId:
          type: integer
          format: int64
          description: "ID интервью"
        config:
          $ref: '#/components/schemas/AgentConfig'
      required: [name, description, interviewId, config]

    AgentUpdateRequest:
      type: object
      properties:
        name:
          type: string
          description: "Название агента"
        description:
          type: string
          description: "Описание агента"
        config:
          $ref: '#/components/schemas/AgentConfig'
        status:
          $ref: '#/components/schemas/AgentStatusEnum'

    AgentConfig:
      type: object
      properties:
        name:
          type: string
          description: "Название агента"
        description:
          type: string
          description: "Описание агента"
        prompt:
          type: string
          description: "Промпт для агента"
        voiceId:
          type: string
          description: "ID голоса в ElevenLabs"
        voiceSettings:
          $ref: '#/components/schemas/VoiceSettings'
        tools:
          type: array
          items:
            type: string
          description: "Список доступных инструментов"
        webhookUrl:
          type: string
          description: "URL для webhook событий"
        language:
          type: string
          description: "Язык агента"
          example: "ru"
        personality:
          type: string
          description: "Личность агента"
          example: "professional"
      required: [name, description, prompt, voiceId]

    VoiceSettings:
      type: object
      properties:
        stability:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: "Стабильность голоса"
          example: 0.75
        similarityBoost:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: "Усиление сходства"
          example: 0.85
        style:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: "Стиль голоса"
          example: 0.5
        useSpeakerBoost:
          type: boolean
          description: "Использовать усиление говорящего"
          example: true

    AgentTestRequest:
      type: object
      properties:
        message:
          type: string
          description: "Тестовое сообщение"
        context:
          type: object
          description: "Контекст для тестирования"
      required: [message]

    AgentTestResponse:
      type: object
      properties:
        success:
          type: boolean
          description: "Успешность теста"
        response:
          type: string
          description: "Ответ агента"
        duration:
          type: integer
          description: "Время ответа в миллисекундах"
        error:
          type: string
          description: "Ошибка, если есть"

    AgentsPaginatedResponse:
      $ref: '#/components/schemas/PaginatedResponse'
      description: "Пагинированный список агентов"
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/Agent'

    # Webhook Schemas
    ElevenLabsWebhookEvent:
      type: object
      properties:
        type:
          $ref: '#/components/schemas/WebhookEventTypeEnum'
          description: "Тип события"
        interviewId:
          type: string
          description: "ID интервью"
        sessionId:
          type: string
          description: "ID сессии"
        agentId:
          type: string
          description: "ID агента"
        timestamp:
          type: string
          format: date-time
          description: "Время события"
        data:
          type: object
          description: "Данные события"
      required: [type, timestamp]

    # Enhanced Interview Schemas
    InterviewStartRequest:
      type: object
      properties:
        voiceMode:
          type: boolean
          description: "Включить голосовой режим"
          default: false
        includeCandidateData:
          type: boolean
          description: "Включить данные для кандидата"
          default: true
        agentConfig:
          $ref: '#/components/schemas/AgentConfig'
        voiceSettings:
          $ref: '#/components/schemas/VoiceSettings'
        autoCreateAgent:
          type: boolean
          description: "Автоматически создать агента"
          default: true

    InterviewStartResponse:
      type: object
      properties:
        interviewId:
          type: integer
          format: int64
          description: "ID интервью"
        status:
          $ref: '#/components/schemas/InterviewStartStatusEnum'
          description: "Статус запуска"
        message:
          type: string
          description: "Дополнительная информация"
        agentId:
          type: string
          description: "ID созданного агента (если voiceMode=true)"
        sessionId:
          type: string
          description: "ID голосовой сессии (если voiceMode=true)"
        webhookUrl:
          type: string
          description: "URL для webhook событий (если voiceMode=true)"
        candidateData:
          $ref: '#/components/schemas/InterviewCandidateData'
          description: "Данные для кандидата (если includeCandidateData=true)"

    # Enums
    AgentStatusEnum:
      type: string
      enum: [ACTIVE, INACTIVE, DELETED, ERROR, CREATING]
      description: "Статус агента"

    VoiceSessionStatusEnum:
      type: string
      enum: [CREATED, ACTIVE, ENDED, ERROR]
      description: "Статус голосовой сессии"

    InterviewStartStatusEnum:
      type: string
      enum: [STARTED, AGENT_CREATED, ERROR]
      description: "Статус запуска интервью"

    WebhookEventTypeEnum:
      type: string
      enum: [AGENT_MESSAGE, AGENT_TOOL_CALL, CONVERSATION_ENDED, CONVERSATION_STARTED, ERROR]
      description: "Тип webhook события"

    VoiceMessageTypeEnum:
      type: string
      enum: [AGENT_QUESTION, USER_ANSWER, AGENT_MESSAGE, SYSTEM_MESSAGE]
      description: "Тип голосового сообщения"

    InterviewCandidateData:
      type: object
      description: "Минимальные данные для кандидата"
      properties:
        interview:
          type: object
          properties:
            id:
              type: integer
              format: int64
            status:
              $ref: '#/components/schemas/InterviewStatusEnum'
            createdAt:
              type: string
              format: date-time
            startedAt:
              type: string
              format: date-time
            finishedAt:
              type: string
              format: date-time
          required: [id, status, createdAt]
        settings:
          type: object
          properties:
            answerTime:
              type: integer
              description: "Время на ответ в секундах"
              example: 120
            language:
              type: string
              description: "Язык интервью"
              example: "Русский"
            saveAudio:
              type: boolean
              description: "Сохранять аудио"
              example: true
            saveVideo:
              type: boolean
              description: "Сохранять видео"
              example: false
            randomOrder:
              type: boolean
              description: "Случайный порядок вопросов"
              example: false
            minScore:
              type: number
              format: float
              description: "Минимальный проходной балл"
              example: 70.0
          required: [answerTime, language, saveAudio, saveVideo, randomOrder, minScore]
        questions:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                format: int64
              text:
                type: string
                description: "Текст вопроса"
              type:
                $ref: '#/components/schemas/QuestionTypeEnum'
              order:
                type: integer
                description: "Порядок вопроса"
              isRequired:
                type: boolean
                description: "Обязательный вопрос"
            required: [id, text, type, order]
          description: "Список вопросов для интервью"
        position:
          type: object
          properties:
            title:
              type: string
              description: "Название вакансии"
              example: "Java Developer"
            level:
              $ref: '#/components/schemas/PositionLevelEnum'
              description: "Уровень позиции"
          required: [title, level]
        progress:
          type: object
          properties:
            currentQuestion:
              type: integer
              description: "Номер текущего вопроса (начиная с 0)"
              example: 0
            totalQuestions:
              type: integer
              description: "Общее количество вопросов"
              example: 5
            answeredQuestions:
              type: integer
              description: "Количество отвеченных вопросов"
              example: 0
            remainingTime:
              type: integer
              description: "Оставшееся время в секундах"
              example: 600
          required: [currentQuestion, totalQuestions, answeredQuestions, remainingTime]
        checklist:
          type: array
          items:
            type: object
            properties:
              text:
                type: string
                description: "Текст пункта чек-листа"
              completed:
                type: boolean
                description: "Выполнен ли пункт"
            required: [text, completed]
          description: "Чек-лист для подготовки к интервью"
        inviteInfo:
          type: object
          properties:
            language:
              type: string
              description: "Язык интервью"
              example: "Русский"
            questionsCount:
              type: integer
              description: "Количество вопросов"
              example: 5
            estimatedDuration:
              type: integer
              description: "Примерная длительность в минутах"
              example: 15
          required: [language, questionsCount, estimatedDuration]
      required: [interview, settings, questions, position, progress, checklist, inviteInfo]

  securitySchemes:
    CandidateAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    AdminAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

# Глобальные настройки security убраны - каждый метод определяет свою авторизацию

x-readme:
  explorer-enabled: true
  proxy-enabled: true
  samples-languages:
    - curl
    - node
    - javascript
    - python
    - go
    - java
    - php 